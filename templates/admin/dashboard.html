{% extends "base.html" %}

{% block title %} - Admin Dashboard{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">Admin Dashboard</h1>
    
    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="dashboard-stat bg-primary text-white rounded">
                <i class="fas fa-car fa-2x mb-2"></i>
                <h2>{{ stats.total_cars }}</h2>
                <p class="mb-0">Total Cars</p>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="dashboard-stat bg-info text-white rounded">
                <i class="fas fa-list fa-2x mb-2"></i>
                <h2>{{ stats.total_models }}</h2>
                <p class="mb-0">Car Models</p>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="dashboard-stat bg-success text-white rounded">
                <i class="fas fa-key fa-2x mb-2"></i>
                <h2>{{ stats.active_rentals }}</h2>
                <p class="mb-0">Active Rentals</p>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="row mb-4">
        <div class="col-md-6 mb-3">
            <a href="{{ url_for('add_car') }}" class="btn btn-primary w-100 p-3">
                <i class="fas fa-plus-circle"></i> Add New Car
            </a>
        </div>
        <div class="col-md-6 mb-3">
            <a href="{{ url_for('add_car_model') }}" class="btn btn-info w-100 p-3">
                <i class="fas fa-plus-circle"></i> Add New Car Model
            </a>
        </div>
    </div>

    <!-- Cars Management -->
    <div class="card mb-4">
        <div class="card-header bg-dark">
            <h4 class="mb-0">Cars Management</h4>
        </div>
        <div class="card-body">
            {% if cars %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Brand</th>
                                <th>Year</th>
                                <th>Models</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for car in cars %}
                                <tr>
                                    <td>{{ car.id }}</td>
                                    <td>{{ car.brand }}</td>
                                    <td>{{ car.year }}</td>
                                    <td>{{ car.models.count() }}</td>
                                    <td>
                                        {% if car.is_available %}
                                            <span class="badge bg-success">Available</span>
                                        {% else %}
                                            <span class="badge bg-danger">Unavailable</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{{ url_for('edit_car', car_id=car.id) }}" class="btn btn-sm btn-warning me-1">
                                            <i class="fas fa-edit"></i> Edit
                                        </a>
                                        <form method="POST" action="{{ url_for('delete_car', car_id=car.id) }}" class="d-inline">
                                            <button type="submit" class="btn btn-sm btn-danger delete-confirm">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info">
                    No cars available. Add your first car now!
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Car Models Management -->
    <div class="card">
        <div class="card-header bg-dark">
            <h4 class="mb-0">Car Models Management</h4>
        </div>
        <div class="card-body">
            {% if car_models %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Car</th>
                                <th>Model</th>
                                <th>Price/Day</th>
                                <th>Features</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for model in car_models %}
                                <tr>
                                    <td>{{ model.id }}</td>
                                    <td>{{ model.car.brand }} ({{ model.car.year }})</td>
                                    <td>{{ model.name }}</td>
                                    <td>${{ model.price_per_day }}</td>
                                    <td>
                                        <span class="badge bg-secondary me-1">{{ model.transmission }}</span>
                                        <span class="badge bg-secondary me-1">{{ model.fuel_type }}</span>
                                        {% if model.air_conditioning %}
                                            <span class="badge bg-secondary">A/C</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if model.is_available %}
                                            <span class="badge bg-success">Available</span>
                                        {% else %}
                                            <span class="badge bg-danger">Rented</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{{ url_for('edit_car_model', model_id=model.id) }}" class="btn btn-sm btn-warning me-1">
                                            <i class="fas fa-edit"></i> Edit
                                        </a>
                                        <form method="POST" action="{{ url_for('delete_car_model', model_id=model.id) }}" class="d-inline">
                                            <button type="submit" class="btn btn-sm btn-danger delete-confirm">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info">
                    No car models available. Add your first car model now!
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Active Rentals -->
    {% if active_rentals %}
        <div class="card mt-4">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">Active Rentals</h4>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>User</th>
                                <th>Car Model</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Total Price</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for rental in active_rentals %}
                                <tr>
                                    <td>{{ rental.id }}</td>
                                    <td>{{ rental.renter.username }}</td>
                                    <td>{{ rental.car_model.car.brand }} {{ rental.car_model.name }}</td>
                                    <td>{{ rental.start_date.strftime('%Y-%m-%d') }}</td>
                                    <td>{{ rental.end_date.strftime('%Y-%m-%d') }}</td>
                                    <td>${{ rental.total_price }}</td>
                                    <td>
                                        <span class="badge bg-success">{{ rental.status }}</span>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
